# 변경 가능성을 최소화하라
* `불변 클래스`는 인스턴스 내부의 값을 수정할 수 없는 클래스를 뜻한다.

## 불변 클래스 생성 방법
### 1. 객체의 상태를 변경하는 메서드를 제공하지 않는다.

### 2. 클래스를 확장할 수 없도록 한다.
* 하위 클래스에서 부주의하게 객체의 상태를 변하게 만드는 사태를 예방할 수 있다.
* 가장 대표적인 방법은 클래스를 final로 선언하는 것이다.
* 추가적으로 **모든 생성자를 private, package-private로 선언하고 public 정적 팩토리를 제공.**

### 3. 모든 필드를 final로 선언한다.
* 설계도 설계지만, 이 방법은 **사용자들에게 설계자의 의도를 가장 명확하게 드러내는 방법 중 하나**다.
* 추가적으로 인스턴스를 동기화 없이 다른 스레드로 건네도 문제없이 동작하게끔 보장하는 데도 필요하다.
* 사실 이 규칙은 너무 지키기가 어렵다. 성능을 위해 제한을 푸는 방법도 있다.

### 4. 모든 필드를 private으로 선언한다.
* 클라이언트가 직접 접근해 필드를 수정하는 것을 막아주는 방법이다.
* 보통 기본 타입 필드나, 불변 객체를 참조하는 필드를 `public final`로만 선언해도 불변 객체가 되나,  
  다음 release에서 **내부 표현을 바꾸지 못하므로 권장하는 방법은 아니다.**

### 5. 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.
* 클래스에 가변 객체를 참조하는 필드가 하나라도 있다면, 클라이언트가 참조를 얻을 수 없도록 막아야 한다.
  * 접근자 메서드가 그 필드를 그대로 반환해서도 안된다.
  * 생성자, 접근자, readObject 메서드 모두 방어적 복사(깊은 복사)를 수행해야 한다.
  * `Complex.class` 참고
  

## 불변 클래스 장점
### 단순하다
* 생명주기 내 상태가 변경되지 않고 그대로 간직한다.

### 스레드에 안전하다
* 여러 스레드가 동시에 사용해도 변경되지 않기 때문에 동기화할 필요가 없어진다.
* 안심하고 공유할 수 있다.
* 그렇기 때문에 왠만하면 최대한 재활용 하는 방향을 잡아야 한다.

### 불변 객체끼리 내부 데이터를 공유 할 수 있다.

### 객체를 만들 때 다른 불변 객체들을 구성요소로 사용하면 이점이 많다.
* 아무리 구조가 복잡해지더라도, 불변식을 유지하기가 쉬워진다.
* 가령 Map.key, Set.element 들은 불변 객체를 사용하면 안성맞춤이다.

## 단점
### 값이 다르면 반드시 독립된 객체로 만들어야 한다.
* 많은 값을 가지고 있는 객체를 불변으로 만들어 버리게 되면, 큰 비용을 소모할 수 있다.
  * ex: Member(필드 100개) 객체 중 단 하나의 필드만 변경해야 할 때 => 아예 새로 만드는 것은 매우 큰 손해.
* 이렇게 재사용성을 고려해서 만들어야 한다.

## 단점 극복 방법
### 1. 요소가 바뀌는 지점을 예측해 다단계 연산들을 기본 기능으로 제공
* 이를 통해 단계마다 객체를 생성하지 않아도 된다.
* 예측이 너무 어려운 단점이 있다.

## 결론
* 무조건 Getter, Setter을 만들지 마라
* 클래스는 꼭 필요한 경우가 아니면 불변이어야 한다.
* 불변으로 만들 수 없는 클래스는 변경할 수 있는 부분을 최소한으로 줄이자.
  * 다른 합당한 이유가 없다면 모든 필드는 private final 이어야 한다.
* 생성자는 불변식 설정이 모두 완료된 (=초기화가 끝난) 상태의 객체를 생성해야 한다.
